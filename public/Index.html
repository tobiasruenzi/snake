<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="js/dist/paper-full.js"></script>

<script type="text/paperscript" canvas="paper">


ws = new WebSocket('wss://localhost:8999');

ws.onopen = function (event) 
{
	console.log('Connecte au server');
};

var myBall=[];
var tabCercles=[];
var tabSerpent=[];

var numJoueur;



var from = new Point(0, 0);
var to = new Point(1200, 800);
var rect = new Path.Rectangle(from, to);
rect.strokeColor = 'black';

var vectorDir =to* Point.random();
vectorDir.length = 5;


function onMouseDown(event) {
	vectorDir = event.point - tabSerpent[numJoueur][0].position;
	vectorDir.length = 5;
	var message = { 
			type : "tete",
			x : vectorDir.x,
			y : vectorDir.y
	};

	ws.send(JSON.stringify(message));
}

function onFrame(event) {

	ws.onmessage = function (message) { 
		var msg = JSON.parse(message.data);
		switch(msg.type) {	
			case "majserpents" :
			//var cercle=new Path.Circle(300,300, 50);
			//cercle.fillColor= new Color(Math.random(),Math.random(),Math.random());
				numJoueur = msg.index;
				Serpent = msg.Serpent;
				for(var y=0;y<Serpent.length;y++){
					
					if(y==tabSerpent.length-1){
						//mise a jour
						for (var i=0; i<Serpent[y].length;i++){
							tabSerpent[y][i].position.x = Serpent[y][i].x;

							tabSerpent[y][i].position.y = Serpent[y][i].y;	
						}
					}
					else {
						//creation
						var color = new Color(Math.random(),Math.random(),Math.random());
						var tabCercles=[];
						for (var i=0; i<Serpent[y].length;i++){
							var cercle=new Path.Circle(Serpent[y][i].x,Serpent[y][i].y, 20);
							cercle.fillColor= color;
							cercle.fillColor.hue =  cercle.fillColor.hue + i;
							tabCercles.push(cercle);
						}
						tabSerpent.push(tabCercles);
					}
				}
				break;
			case "delserpents" :
				tabSerpent.splice(msg.index,1); 
				break;			
		}

	};
//if (){

}

</script>

<title>this is the Game</title>
</head>
<body>

	<h1>Snakes on a Plan</h1>
	<canvas id="paper" width="1200" height="800" keepalive="true" style="border:1px solid #000000;"></canvas>
</body>
</html>
